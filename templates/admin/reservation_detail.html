{% extends "admin/base.html" %}

{% block title %}Reservation #{{ reservation.id }}{% endblock %}
{% block page_title %}Reservation Details{% endblock %}

{% block content %}
<div class="row g-4">
    <div class="col-lg-8">
        <div class="glass-card">
            <div class="d-flex justify-content-between align-items-start mb-4">
                <div>
                    <h4 class="mb-2" style="color: var(--accent-cyan);">Reservation #{{ reservation.id }}</h4>
                    <span class="badge-status badge-{{ reservation.status }} fs-6">
                        {{ reservation.status|replace('_', ' ')|capitalize }}
                    </span>
                </div>
                <div>
                    <a href="{{ url_for('admin.edit_reservation', reservation_id=reservation.id) }}" 
                       class="btn btn-outline-glow">
                        <i class="bi bi-pencil me-1"></i> Edit
                    </a>
                </div>
            </div>
            
            <div class="row g-4">
                <div class="col-md-6">
                    <h6 class="mb-3" style="color: var(--text-secondary);">
                        <i class="bi bi-person me-2" style="color: var(--accent-cyan);"></i>Guest Information
                    </h6>
                    <div class="p-3" style="background: var(--bg-secondary); border-radius: 12px; border: 1px solid var(--border-color);">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Name</span>
                            <strong>{{ reservation.user_name }}</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Phone</span>
                            <a href="tel:{{ reservation.phone_number }}" style="color: var(--accent-cyan);">
                                {{ reservation.phone_number }}
                            </a>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span class="text-muted">Party Size</span>
                            <span class="badge-status badge-confirmed">
                                <i class="bi bi-people-fill me-1"></i>{{ reservation.number_of_guests }} guests
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <h6 class="mb-3" style="color: var(--text-secondary);">
                        <i class="bi bi-calendar-event me-2" style="color: var(--accent-green);"></i>Reservation Details
                    </h6>
                    <div class="p-3" style="background: var(--bg-secondary); border-radius: 12px; border: 1px solid var(--border-color);">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Date</span>
                            <strong>{{ reservation.date_time.strftime('%A, %B %d, %Y') if reservation.date_time else 'N/A' }}</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Time</span>
                            <strong style="color: var(--accent-cyan);">{{ reservation.date_time.strftime('%H:%M') if reservation.date_time else 'N/A' }}</strong>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span class="text-muted">Duration</span>
                            <span>{{ reservation.time_slot or 2 }} hours</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <hr style="border-color: var(--border-color); margin: 1.5rem 0;">
            
            <div class="row">
                <div class="col-md-6">
                    <h6 class="mb-3" style="color: var(--text-secondary);">
                        <i class="bi bi-info-circle me-2" style="color: var(--accent-blue);"></i>System Information
                    </h6>
                    <div class="p-3" style="background: var(--bg-secondary); border-radius: 12px; border: 1px solid var(--border-color);">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">User ID</span>
                            <code style="color: var(--accent-purple);">{{ reservation.user_id }}</code>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span class="text-muted">Created</span>
                            <span>{{ reservation.time_created.strftime('%Y-%m-%d %H:%M:%S') if reservation.time_created else 'N/A' }}</span>
                        </div>
                    </div>
                </div>
                
                {% if reservation.special_requests %}
                <div class="col-md-6">
                    <h6 class="mb-3" style="color: var(--text-secondary);">
                        <i class="bi bi-chat-quote me-2" style="color: var(--accent-yellow);"></i>Special Requests
                    </h6>
                    <div class="p-3" style="background: var(--bg-secondary); border-radius: 12px; border: 1px solid var(--border-color);">
                        <p class="mb-0">{{ reservation.special_requests }}</p>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <!-- Quick Actions -->
        <div class="glass-card mb-4">
            <div class="glass-card-header mb-3">
                <div class="glass-card-title">
                    <i class="bi bi-lightning-fill" style="color: var(--accent-yellow);"></i>
                    Quick Actions
                </div>
            </div>
            
            {% if reservation.status == 'pending' %}
            <form action="{{ url_for('admin.update_reservation_status', reservation_id=reservation.id) }}" 
                  method="POST" class="mb-2">
                <input type="hidden" name="status" value="confirmed">
                <button type="submit" class="btn btn-glow w-100">
                    <i class="bi bi-check-circle me-2"></i>Confirm Reservation
                </button>
            </form>
            {% endif %}
            
            {% if reservation.status in ['pending', 'confirmed'] %}
            <form action="{{ url_for('admin.update_reservation_status', reservation_id=reservation.id) }}" 
                  method="POST" class="mb-2">
                <input type="hidden" name="status" value="arrived">
                <button type="submit" class="btn btn-outline-glow w-100" style="border-color: var(--accent-blue); color: var(--accent-blue);">
                    <i class="bi bi-person-check me-2"></i>Mark as Arrived
                </button>
            </form>
            {% endif %}
            
            {% if reservation.status == 'arrived' %}
            <form action="{{ url_for('admin.update_reservation_status', reservation_id=reservation.id) }}" 
                  method="POST" class="mb-2">
                <input type="hidden" name="status" value="seated">
                <button type="submit" class="btn btn-outline-glow w-100" style="border-color: var(--accent-purple); color: var(--accent-purple);">
                    <i class="bi bi-person-workspace me-2"></i>Mark as Seated
                </button>
            </form>
            {% endif %}
            
            {% if reservation.status in ['confirmed', 'arrived', 'seated'] %}
            <form action="{{ url_for('admin.update_reservation_status', reservation_id=reservation.id) }}" 
                  method="POST" class="mb-2">
                <input type="hidden" name="status" value="completed">
                <button type="submit" class="btn btn-outline-glow w-100" style="border-color: var(--accent-green); color: var(--accent-green);">
                    <i class="bi bi-check-all me-2"></i>Mark as Completed
                </button>
            </form>
            {% endif %}
            
            {% if reservation.status not in ['cancelled', 'completed', 'no_show'] %}
            <hr style="border-color: var(--border-color);">
            
            <form action="{{ url_for('admin.update_reservation_status', reservation_id=reservation.id) }}" 
                  method="POST" class="mb-2"
                  onsubmit="return confirm('Mark this reservation as No Show?');">
                <input type="hidden" name="status" value="no_show">
                <button type="submit" class="btn btn-outline-glow w-100" style="border-color: var(--accent-yellow); color: var(--accent-yellow);">
                    <i class="bi bi-person-x me-2"></i>Mark as No Show
                </button>
            </form>
            
            <form action="{{ url_for('admin.delete_reservation', reservation_id=reservation.id) }}" 
                  method="POST"
                  onsubmit="return confirm('Are you sure you want to cancel this reservation?');">
                <button type="submit" class="btn w-100" style="background: rgba(239, 68, 68, 0.1); border: 1px solid var(--accent-red); color: var(--accent-red);">
                    <i class="bi bi-x-lg me-2"></i>Cancel Reservation
                </button>
            </form>
            {% endif %}
            
            {% if reservation.status == 'cancelled' %}
            <form action="{{ url_for('admin.update_reservation_status', reservation_id=reservation.id) }}" 
                  method="POST">
                <input type="hidden" name="status" value="confirmed">
                <button type="submit" class="btn btn-glow w-100">
                    <i class="bi bi-arrow-counterclockwise me-2"></i>Restore Reservation
                </button>
            </form>
            {% endif %}
            
            {% if reservation.status == 'completed' %}
            <div class="p-3" style="background: rgba(0, 212, 255, 0.1); border-radius: 12px; border: 1px solid var(--accent-cyan);">
                <i class="bi bi-check-circle me-2" style="color: var(--accent-cyan);"></i>
                <span style="color: var(--accent-cyan);">This reservation has been completed.</span>
            </div>
            {% endif %}
            
            {% if reservation.status == 'no_show' %}
            <div class="p-3" style="background: rgba(245, 158, 11, 0.1); border-radius: 12px; border: 1px solid var(--accent-yellow);">
                <i class="bi bi-person-x me-2" style="color: var(--accent-yellow);"></i>
                <span style="color: var(--accent-yellow);">Guest did not show up.</span>
            </div>
            {% endif %}
        </div>
        
        <!-- Contact Guest -->
        <div class="glass-card">
            <div class="glass-card-header mb-3">
                <div class="glass-card-title">
                    <i class="bi bi-telephone" style="color: var(--accent-green);"></i>
                    Contact Guest
                </div>
            </div>
            <a href="tel:{{ reservation.phone_number }}" class="btn btn-outline-glow w-100 mb-2">
                <i class="bi bi-telephone-fill me-2"></i>Call {{ reservation.user_name }}
            </a>
            <a href="sms:{{ reservation.phone_number }}" class="btn btn-outline-glow w-100" style="border-color: var(--accent-green); color: var(--accent-green);">
                <i class="bi bi-chat-dots me-2"></i>Send SMS
            </a>
        </div>
    </div>
</div>

<div class="mt-4">
    <a href="{{ url_for('admin.reservations') }}" class="btn btn-outline-glow">
        <i class="bi bi-arrow-left me-1"></i> Back to Reservations
    </a>
</div>
{% endblock %}
